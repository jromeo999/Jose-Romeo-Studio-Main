<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" type="image/png" href="assets/icon.png">
  <title>SOS MARKETPLACE</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script type="text/javascript">
   (function() {
    // Initialize with your Public Key
    emailjs.init("_vpMAL03l1qt9rrgS");
   })();
  </script>
 </head>
 <body>
  <!-- 1. FLOATING BELL (Facebook Style) -->
  <div id="vendorFloatBell" class="floating-bell hidden" onclick="scrollToOrders()">
   <span style="font-size: 1.2rem;">ğŸ””</span>
   <span id="floatingBadge" class="bell-badge hidden">0</span>
  </div>
  <!-- Audio Element for "Ding" Sound -->
  <audio id="orderSound" src="data:audio/mp3;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG1ineJRgAAA0goL17MAAApzE3j7O541f/z4c6jWv/7c4yjglruz6if/9uCaAAAAAA4EaAOAAAAA405gWFFhAAAaExld03qTkNGqMiZQBAmJYiQXmm6Ts6nGBcACAVjQIv73T4y1U5vKT2QmZSMSh9E6zLHN9GtD2vlwo7wrVe//uQZAmABfSF1/0gAAP0Quv+kAAABWGLX/SAAAVYYtf9IAAA9Af//7r3///6//7el6edaWmsf///////4cn/7clYEA5tJ5/8t//9///+sW//7c4yglru/4if/9uCaAAAAAA4EaAOAAAAA405gWFFhAAAaExld03qTkNGqMiZQBAmJYiQXmm6Ts6nGBcACAVjQIv73T4y1U5vKT2QmZSMSh9E6zLHN9GtD2vlwo7wrVe"></audio>
  <!-- Toast Container -->
  <div id="toast-container"></div>
  <!-- LIGHTBOX (New) -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()">
   <span class="lightbox-close">&times;</span>
   <img id="lightbox-img" src="">
   <div id="lightbox-text" class="lightbox-caption hidden"></div>
  </div>
  <div class="layout-wrapper">
   <!-- SIDEBAR -->
   <header class="sidebar">
    <!-- TOP SECTION (Expands to fill space) -->
    <div class="sidebar-content">
     <div class="brand">
      <h1>SOS Market</h1>
      <div class="datetime" id="clock">--:--</div>
     </div>
     <!-- Login -->
     <!-- Login -->
     <div id="loginSection" style="margin-top: 30px;">
      <div class="input-wrapper">
       <input type="text" id="codeJson" placeholder="Access Code" autocomplete="off">
       <button onclick="handleLogin()" class="icon-btn">âœ</button>
      </div>
      <!-- NEW: FORGOT CODE LINK -->
      <div style="display:flex; gap:10px; margin-top:10px;">
       <button class="menu-btn" onclick="openRegisterModal('buyer')" style="justify-content:center; background:#27272a; border-radius:6px;">Register</button>
       <button class="menu-btn" onclick="openRegisterModal('vendor')" style="justify-content:center; background:#27272a; border-radius:6px;">Vendor</button>
      </div>
      <div class="forgot-container">
          <span onclick="openForgotModal()" class="forgot-link-animated">
              Forgot Code?
          </span>
      </div>
     </div>
     <!-- User Controls -->
     <!-- REPLACE THE EXISTING <div id="userControls"> IN SIDEBAR WITH THIS -->
     <div id="userControls" class="hidden" style="margin-top: 30px;">
      <div class="profile-section">
       <!-- TOP: Big Image with Remove Option -->
       <div class="profile-img-container">
        <div class="profile-img-wrapper" onclick="document.getElementById('profileUpload').click()">
         <img id="sidebarProfileImg" src="">
         <div class="edit-overlay">ğŸ“·</div>
         <input type="file" id="profileUpload" hidden accept="image/*" onchange="uploadProfilePic(this)">
        </div>
        <!-- Remove Image Button (Only shows if custom img exists) -->
        <button id="btnRemoveImg" class="remove-img-btn hidden" onclick="deleteProfileImage()" title="Remove Image">Ã—</button>
       </div>
       <!-- BOTTOM ROW: Split Left and Right -->
       <div class="profile-info">
        <!-- LEFT: Name & Account (Display vs Edit) -->
        <div class="info-left">
         <!-- Display Mode -->
         <div id="profileDisplayMode">
          <div style="display:flex; align-items:center; gap:6px;">
           <div class="user-name" id="displayUserName">Guest</div>
           <button class="icon-edit-pen" onclick="toggleProfileEdit(true)">âœ</button>
          </div>
          <div class="user-acc" id="displayUserAcc">Account</div>
         </div>
         <!-- Edit Mode -->
         <div id="profileEditMode" class="hidden">
          <input type="text" id="editNameInput" oninput="sanitizeInput(this)" class="sidebar-input" placeholder="Name">
          <input type="text" id="editAccInput" class="sidebar-input" placeholder="Account">
          <div class="edit-actions">
           <button class="mini-btn confirm" onclick="saveProfileInfo()">âœ”</button>
           <button class="mini-btn cancel" onclick="toggleProfileEdit(false)">âœ•</button>
          </div>
         </div>
        </div>
        <!-- RIGHT: Access Code -->
        <div class="access-code-display" onclick="copyAccessCode()">
         <span class="ac-label">CODE</span>
         <div class="ac-value-row">
          <span id="displayUserCode">----</span>
         </div>
        </div>
       </div>
      </div>
      <!-- Rest of the buttons remain the same -->
      <button class="menu-btn" onclick="openSlidePanel()">
       <span>ğŸ“œ History</span>
      </button>
      <!-- VENDOR ONLY BUTTONS -->
      <div id="vendorSpecificButtons" class="hidden">
       <button class="menu-btn" onclick="openPaymentSettings()">
        <span>ğŸ’³ Payment Settings</span>
       </button>
       <button class="menu-btn danger-text" onclick="soldOut()">
        <span>ğŸš« Sold Out (All)</span>
       </button>
      </div>
      <!-- BUYER ONLY: UPGRADE BUTTON -->
      <div id="buyerSpecificButtons" class="hidden">
       <button class="menu-btn" onclick="upgradeToVendor()" style="color: #FBBF24;">
        <span>ğŸš€ Upgrade to Vendor</span>
       </button>
      </div>
      <button class="menu-btn" onclick="openHelpModal()" style="color: #60A5FA;">
       <span>ğŸ’¡ How to Use</span>
      </button>
      <button class="menu-btn" onclick="logout()" style="margin-top:20px;">
       <span>ğŸšª Log Out</span>
      </button>
     </div>
     <div class="sidebar-bottom-group">
      <!-- Header text (Hidden on Mobile) -->
      <h4 class="ql-header">Quick Access</h4>
      <div class="quick-links-container">
       <!-- Add your links here -->
       <a href="https://forms.monday.com/forms/e8b1e434735df558cc3f2f8769b9a887?r=use1&fbclid=IwY2xjawOkBT1leHRuA2FlbQIxMQBzcnRjBmFwcF9pZAwzNTA2ODU1MzE3MjgAAR5ZudqagXvXTGNh9jP-pnF4voCudoxiBCnbkECd5dG3WumkSHLoLlVx411cwA_aem_YDzaTBvjuEAzPL7CAaFSDg" target="_blank" class="ql-item">
        <span class="ql-icon">ğŸ†˜</span>
        <span class="ql-text" title="Employee Callin Form">Call-in Form</span>
        <span class="ql-arrow">â†’</span>
       </a>
       <a href="https://forms.monday.com/forms/c207fe9d9caa797b9095bf75220770cc?r=use1" target="_blank" class="ql-item" title="HR Department">
        <span class="ql-icon">ğŸ‘¥</span>
        <span class="ql-text" title="HR Department">HR Dept</span>
        <span class="ql-arrow">â†’</span>
       </a>
       <a href="https://forms.monday.com/forms/84c62c9e68f4cf6cacc10a8b46e73d47?r=use1" target="_blank" class="ql-item" title="Accounting">
        <span class="ql-icon">ğŸ§¾</span>
        <span class="ql-text" title="Accounting">Accounting</span>
        <span class="ql-arrow">â†’</span>
       </a>
       <a href="https://docs.google.com/forms/d/e/1FAIpQLSdCpVaauSezReEwemDJ3NcKhSv03PSHu_4lcx6N9drbYc5-8g/viewform" target="_blank" class="ql-item" title="Employee Referral">
        <span class="ql-icon">ğŸ¤</span>
        <span class="ql-text" title="Employee Referral">Referral</span>
        <span class="ql-arrow">â†’</span>
       </a>
       <a href="https://docs.google.com/forms/d/e/1FAIpQLScQ37O6IO7fcBWFd6f4S1ofzhTc_i4EjlIYwuDpLd2LrgwpnQ/viewform" target="_blank" class="ql-item" title="Med Cert Validation">
        <span class="ql-icon">ğŸ¥</span>
        <span class="ql-text" title="Med Cert Validation">Med Cert</span>
        <span class="ql-arrow">â†’</span>
       </a>
      </div>
      <div class="sidebar-footer">
       <p>Â© 2025 Jose Romeo. All Rights Reserved.</p>
       <div class="dev-credit">
        <span class="trigger-text">
         <span style="color: #e74c3c;">â¤</span> Support Dev </span>
        <div class="tooltip-content">
         <p style="margin: 0 0 8px 0; opacity: 0.8;">Scan to Donate</p>
         <button class="qr-btn" onclick="openLightbox('assets/qr.png')">ğŸ“· View QR</button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </header>
   <!-- MAIN CONTENT -->
   <main class="main-content">
    <!-- BUYER VIEW -->
    <div id="buyerView">
     <!-- Split Container for separation -->
     <div class="menu-split-container">
      <!-- LEFT: TODAY -->
      <div class="menu-column menu-left">
       <h3 class="section-title">
        <div style="display:flex; align-items:center; gap:12px;">
         <span class="btxt">Today's Menu</span>
         <span class="badge-live">LIVE</span>
        </div>
        <div class="header-controls">
         <span class="control-link control-expand" onclick="toggleAllCards('buyerTodayGrid', false)"> â†“ <span class="btn-txt">Expand</span>
         </span>
         <span class="control-link control-collapse" onclick="toggleAllCards('buyerTodayGrid', true)"> â†‘ <span class="btn-txt">Collapse</span>
         </span>
        </div>
       </h3>
       <div class="card-grid" id="buyerTodayGrid"></div>
      </div>
      <!-- RIGHT: PRE-ORDER -->
      <div class="menu-column menu-right">
       <h3 class="section-title">
        <div style="display:flex; align-items:center; gap:12px;">
         <span class="btxt">Pre-Order</span>
         <span class="badge-pre">TOMORROW</span>
        </div>
        <div class="header-controls">
         <span class="control-link control-expand" onclick="toggleAllCards('buyerPreOrderGrid', false)"> â†“ <span class="btn-txt">Expand</span>
         </span>
         <span class="control-link control-collapse" onclick="toggleAllCards('buyerPreOrderGrid', true)"> â†‘ <span class="btn-txt">Collapse</span>
         </span>
        </div>
       </h3>
       <div class="card-grid" id="buyerPreOrderGrid"></div>
      </div>
     </div>
    </div>
    <!-- VENDOR VIEW -->
    <div id="vendorView" class="hidden">
     <div class="dashboard-3-col" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">
      <!-- 1. Inventory -->
      <div class="panel">
       <div class="panel-header-row">
        <h3>My Inventory</h3>
        <button class="btn-sm-primary" onclick="openAddModal()">+ Add Item</button>
       </div>
       <div id="adminProductList" class="inventory-list"></div>
      </div>
      <!-- 2. Incoming Orders -->
      <div class="panel">
       <div class="panel-header-row">
        <h3>Incoming Orders</h3>
        <button class="btn btn-secondary" style="padding:4px 10px; font-size:0.8rem;" onclick="finishDay()">End Shift</button>
       </div>
       <div id="orderList" style="display:flex; flex-direction:column; gap:10px;"></div>
      </div>
      <!-- 3. Market Preview (To buy from others) -->
      <div class="panel">
       <h3>Shop Preview</h3>
       <p style="font-size:0.8rem; color:#777; margin-bottom:10px;">View and buy from other shops</p>
       <div style="display: flex; flex-direction: column; gap: 15px; height: 100%;">
        <!-- Top: Standard / Today -->
        <div style="display: flex; flex-direction: column; overflow: hidden;">
         <h3 style="font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; color: #333;">Standard / Today</h3>
         <!-- Scrollable Container -->
         <div id="vendorPreviewToday" class="buyer-grid" style="overflow-y: auto; max-height: 45vh; border: 1px solid #eee; padding: 5px; border-radius: 6px;"></div>
        </div>
        <!-- Bottom: Pre-Orders -->
        <div style="display: flex; flex-direction: column; overflow: hidden;">
         <h3 style="font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; color: #333;">Pre-Orders</h3>
         <!-- Scrollable Container -->
         <div id="vendorPreviewPreOrder" class="buyer-grid" style="overflow-y: auto; max-height: 45vh; background: #e2e8f0; border: 1px solid #eee; padding: 5px; border-radius: 6px;"></div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- REPLACE EXISTING <div id="adminView"> WITH THIS -->
    <div id="adminView" class="hidden">
     <!-- Split Container (Recycled from Buyer View) -->
     <div class="menu-split-container">
      <!-- LEFT: VENDOR MANAGEMENT -->
      <div class="menu-column menu-left">
       <h3 class="section-title" style="margin-bottom: 15px;">
        <span>ğŸª Vendors</span>
        <span style="font-size:0.7rem; color:#777; font-weight:400;">Merchant Control</span>
       </h3>
       <div id="adminVendorList" class="card-grid">
        <!-- Vendor cards load here -->
       </div>
      </div>
      <!-- RIGHT: BUYER MANAGEMENT -->
      <div class="menu-column menu-right">
       <h3 class="section-title" style="margin-bottom: 15px;">
        <span>ğŸ‘¥ Buyers</span>
        <span style="font-size:0.7rem; color:#777; font-weight:400;">Customer Control</span>
       </h3>
       <!-- Search Bar -->
       <div class="input-wrapper" style="background:white; border:1px solid #ccc; margin-bottom:20px;">
        <span style="padding-left:10px;">ğŸ”</span>
        <input type="text" id="adminBuyerSearch" oninput="renderAdminBuyers(this.value)" placeholder="Search Name or Team..." style="color:black;">
       </div>
       <div id="adminBuyerList" style="display:flex; flex-direction:column; gap:15px;">
        <!-- Buyer Groups load here -->
       </div>
      </div>
     </div>
    </div>
    <div class="mobile-bottom-group">
     <!-- Header text (Hidden on Mobile) -->
     <h4 class="ql-header">Quick Access</h4>
     <div class="quick-links-container">
      <!-- Add your links here -->
      <a href="https://forms.monday.com/forms/e8b1e434735df558cc3f2f8769b9a887?r=use1&fbclid=IwY2xjawOkBT1leHRuA2FlbQIxMQBzcnRjBmFwcF9pZAwzNTA2ODU1MzE3MjgAAR5ZudqagXvXTGNh9jP-pnF4voCudoxiBCnbkECd5dG3WumkSHLoLlVx411cwA_aem_YDzaTBvjuEAzPL7CAaFSDg" target="_blank" class="ql-item">
       <span class="ql-icon">ğŸ†˜</span>
       <span class="ql-text">SOS Callin</span>
       <span class="ql-arrow">â†’</span>
      </a>
      <a href="https://forms.monday.com/forms/c207fe9d9caa797b9095bf75220770cc?r=use1" target="_blank" class="ql-item">
       <span class="ql-icon">ğŸ‘¥</span>
       <span class="ql-text">HR Dept</span>
       <span class="ql-arrow">â†’</span>
      </a>
      <a href="https://forms.monday.com/forms/84c62c9e68f4cf6cacc10a8b46e73d47?r=use1" target="_blank" class="ql-item">
       <span class="ql-icon">ğŸ§¾</span>
       <span class="ql-text">Accounting</span>
       <span class="ql-arrow">â†’</span>
      </a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdCpVaauSezReEwemDJ3NcKhSv03PSHu_4lcx6N9drbYc5-8g/viewform" target="_blank" class="ql-item">
       <span class="ql-icon">ğŸ¤</span>
       <span class="ql-text">Referral</span>
       <span class="ql-arrow">â†’</span>
      </a>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLScQ37O6IO7fcBWFd6f4S1ofzhTc_i4EjlIYwuDpLd2LrgwpnQ/viewform" target="_blank" class="ql-item">
       <span class="ql-icon">ğŸ¥</span>
       <span class="ql-text">Med Cert</span>
       <span class="ql-arrow">â†’</span>
      </a>
     </div>
     <div class="sidebar-footer">
      <p>Â© 2025 Jose Romeo. All Rights Reserved.</p>
      <div class="dev-credit">
       <span class="trigger-text">
        <span style="color: #e74c3c;">â¤</span> Support Dev </span>
       <div class="tooltip-content">
        <p style="margin: 0 0 8px 0; opacity: 0.8;">Scan to Donate</p>
        <button class="qr-btn" onclick="openLightbox('assets/qr.png')">ğŸ“· View QR</button>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div>
  <!-- SLIDE OVER PANEL (HISTORY) -->
  <div class="slide-panel-overlay" id="slideOverlay" onclick="closeSlidePanel()"></div>
  <div class="slide-panel" id="slidePanel">
   <div class="slide-header">
    <h2 id="historyTitle">History</h2>
    <button class="close-panel-btn" onclick="closeSlidePanel()">&times;</button>
   </div>
   <div class="slide-content">
    <!-- Vendor Toggles -->
    <div id="vendorHistoryToggle" class="hidden" style="margin-bottom:15px; background:#f4f4f5; padding:4px; border-radius:8px; display:flex;">
     <button id="btnShowSales" onclick="switchHistoryMode('sales')" style="flex:1; border:none; padding:8px; border-radius:6px; font-weight:600; cursor:pointer;">My Sales</button>
     <button id="btnShowPurchases" onclick="switchHistoryMode('purchases')" style="flex:1; border:none; padding:8px; border-radius:6px; font-weight:600; cursor:pointer;">My Purchases</button>
    </div>
    <!-- Filters -->
    <div class="history-filters">
     <select id="filterMonth" onchange="renderHistory()"></select>
     <select id="filterYear" onchange="renderHistory()"></select>
     <div style="margin-left:auto; font-weight:800; font-size:1.1rem; align-self:center;" id="historyTotalBadge">â‚±0</div>
    </div>
    <!-- Table -->
    <table class="compact-table">
     <thead id="historyTableHead"></thead>
     <tbody id="historyTableBody"></tbody>
    </table>
   </div>
  </div>
  <!-- MODAL: ADD/EDIT PRODUCT -->
  <!-- REPLACE EXISTING #productModal -->
  <div id="productModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeModal()">Ã—</div>
    <h3 id="modalTitle">Add Item</h3>
    <input type="hidden" id="mId">
    <!-- IMAGE UPLOAD (Modified: No Tabs, Added Remove Button) -->
    <div class="image-upload-box" style="position: relative;" onclick="document.getElementById('mFile').click()">
     <!-- Remove Button -->
     <button id="btnRemoveProdImg" class="remove-img-btn hidden" onclick="event.stopPropagation(); removeProductImage()" style="top: -10px; right: -10px; z-index: 5;" title="Remove Image">Ã—</button>
     <div id="uploadPlaceholder" class="upload-placeholder">
      <span style="font-size:1.5rem">ğŸ“·</span>
      <br>Click to upload image
     </div>
     <img id="mPreview" class="image-preview">
     <input type="file" id="mFile" hidden accept="image/*" onchange="previewImage(this)">
    </div>
    <!-- EXISTING INPUTS -->
    <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7; margin-bottom:10px;">
     <input type="text" id="mName" placeholder="Item Name (e.g. Adobo)" style="color:black;">
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom:10px;">
     <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7;">
      <input type="number" id="mPrice" placeholder="Price (â‚±)" style="color:black;">
     </div>
     <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7;">
      <input type="number" id="mStock" placeholder="Qty / Stock" style="color:black;">
     </div>
    </div>
    <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7; margin-bottom:10px;">
     <input type="text" id="mVariants" placeholder="Variants (e.g. Regular, Spicy) - Optional" style="color:black;">
    </div>
    <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7; margin-bottom:20px;">
     <input type="text" id="mNote" placeholder="Note (e.g. Spicy, Contains Nuts)" style="color:black;">
    </div>
    <div class="btn-grid">
     <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
     <button class="btn btn-primary" onclick="commitProduct()">Save Item</button>
    </div>
   </div>
  </div>
  <!-- NEW: USER INFO CARD MODAL (For Vendors to see Buyer Info) -->
  <!-- USER INFO MODAL -->
  <div id="userInfoModal" class="modal">
   <!-- Removed "Customer Info" title from HTML, moved visual hierarchy to the card itself -->
   <div class="modal-card" style="max-width: 400px; padding: 0; background: transparent; box-shadow: none; border: none;">
    <!-- Close X for the Modal Wrapper -->
    <div class="close-modal-x" onclick="closeModalById('userInfoModal')" style="position: absolute; right: 0; top: -50px; background:white;">Ã—</div>
    <div id="userCardContainer">
     <!-- JS Injects Profile Card Here -->
    </div>
   </div>
  </div>
  <!-- MODAL: REGISTER -->
  <div id="registerModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeRegisterModal()">Ã—</div>
    <h3 id="regTitle">Join</h3>
    <input type="hidden" id="regRole">
    <div style="margin-bottom:15px;">
     <label style="font-size:0.75rem; font-weight:700;">Full Name</label>
     <input type="text" id="regName" style="width:100%; padding:10px; border:1px solid #e4e4e7; border-radius:8px; margin-top:5px;">
    </div>
    <div style="margin-bottom:15px;">
     <label style="font-size:0.75rem; font-weight:700;">Account</label>
     <input type="text" id="regAccount" oninput="sanitizeInput(this)" style="width:100%; padding:10px; border:1px solid #e4e4e7; border-radius:8px; margin-top:5px;">
    </div>
    <!-- NEW: EMAIL INPUT (For Recovery) -->
    <div style="margin-bottom:20px;">
     <label style="font-size:0.75rem; font-weight:700;">Email (For Recovery)</label>
     <input type="email" id="regEmail" placeholder="Optional but recommended" style="width:100%; padding:10px; border:1px solid #e4e4e7; border-radius:8px; margin-top:5px;">
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="submitRegistration()">Register</button>
   </div>
  </div>
  <!-- MODAL: CONFIRMATION (New) -->
  <div id="confirmModal" class="modal">
   <div class="modal-card" style="max-width: 320px; text-align: center;">
    <h3 style="margin-top:0;">Bank Details</h3>
    <p id="confirmMsg" style="color:#71717A; margin-bottom:24px; font-size: 0.95rem;"></p>
    <div class="btn-grid">
     <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
     <button class="btn btn-primary" id="confirmYesBtn" onclick="executeConfirm()">Yes, Confirm</button>
    </div>
   </div>
  </div>
  <!-- MODAL: PAYMENT SETTINGS (NEW) -->
  <div id="paymentSettingsModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeModalById('paymentSettingsModal')">Ã—</div>
    <h3>Payment Settings</h3>
    <p style="font-size:0.8rem; color:#777; margin-bottom:15px;">Choose accepted methods.</p>
    <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
     <!-- CASH -->
     <label class="payment-option-row">
      <input type="checkbox" id="psCash">
      <span>ğŸ’µ Cash</span>
     </label>
     <!-- PAYDAY -->
     <label class="payment-option-row">
      <input type="checkbox" id="psPayday">
      <span>ğŸ“… Payday</span>
     </label>
     <!-- BANK TRANSFER -->
     <label class="payment-option-row">
      <input type="checkbox" id="psBank" onchange="toggleBankSettings(this.checked)">
      <span>ğŸ¦ Bank Transfer / GCash / Maya / Atome / etc.</span>
     </label>
    </div>
    <!-- HIDDEN BANK DETAILS SECTION -->
    <div id="bankSettings" class="hidden" style="background:#f9fafb; padding:10px; border-radius:8px; border:1px solid #e4e4e7; margin-bottom:20px;">
     <h4 style="margin:0 0 10px 0; font-size:0.85rem;">Bank Details</h4>
     <!-- Text Input -->
     <div class="input-wrapper" style="margin-bottom:10px;">
      <input type="text" id="psBankText" placeholder="Acct Name & Number..." style="color:black;">
     </div>
     <!-- QR Image Upload -->
     <div class="image-upload-box" style="height:100px;" onclick="document.getElementById('psQRFile').click()">
      <div id="psQRPlaceholder" class="upload-placeholder">
       <span style="font-size:1.2rem">ğŸ“·</span>
       <br>Upload QR Code
      </div>
      <img id="psQRPreview" class="image-preview">
      <input type="file" id="psQRFile" hidden accept="image/*" onchange="previewQR(this)">
     </div>
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="savePaymentSettings()">Save Settings</button>
   </div>
  </div>
  <div id="helpModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeModalById('helpModal')">Ã—</div>
    <h3 id="helpTitle">Guide</h3>
    <div id="helpContent" style="font-size: 0.9rem; color: #555; line-height: 1.6;"></div>
   </div>
  </div>
  <!-- ADD THIS AT THE BOTTOM WITH OTHER MODALS -->
  <div id="userHistoryModal" class="modal">
   <div class="modal-card" style="max-width: 500px; height: 80vh; display: flex; flex-direction: column;">
    <div class="close-modal-x" onclick="closeModalById('userHistoryModal')">Ã—</div>
    <!-- Header -->
    <div style="border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
     <h3 id="histModalName" style="margin:0;">User Name</h3>
     <span id="histModalRole" style="font-size:0.75rem; color:#777; text-transform:uppercase; letter-spacing:1px;">ROLE</span>
    </div>
    <!-- Scrollable List -->
    <div id="histModalContent" style="flex:1; overflow-y:auto; padding-right:5px;">
     <!-- History items load here -->
    </div>
    <!-- Footer -->
    <div style="border-top:1px solid #eee; padding-top:15px; margin-top:10px; text-align:right;">
     <span style="font-size:0.8rem; color:#777;">Total Volume: </span>
     <strong id="histModalTotal" style="font-size:1.1rem; color:#18181b;">â‚±0</strong>
    </div>
   </div>
  </div>
  <div id="bankDetailsModal" class="modal">
   <div class="modal-card" style="max-width: 500px; padding: 30px;">
    <div class="close-modal-x" onclick="closeModalById('bankDetailsModal')">Ã—</div>
    <h3 style="margin-top:0; margin-bottom:20px; text-align:center;">Payment Details</h3>
    <!-- This container is where JS will inject the Card -->
    <div id="bankCardContainer"></div>
    <button class="btn btn-secondary" style="width:100%; margin-top:20px;" onclick="closeModalById('bankDetailsModal')">Close</button>
   </div>
  </div>
  <!-- REPORT USER MODAL -->
  <div id="reportModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeModalById('reportModal')">Ã—</div>
    <h3>Report User</h3>
    <p style="font-size:0.8rem; color:#71717A; margin-bottom:15px;"> Help us keep the market safe. This will be sent to the Admin. </p>
    <input type="hidden" id="reportTargetCode">
    <input type="hidden" id="reportTargetName">
    <!-- Reason -->
    <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7; margin-bottom:10px;">
     <textarea id="reportReason" rows="3" placeholder="Reason (e.g. No show, Rude behavior, Fake receipt)" style="width:100%; border:none; background:transparent; padding:10px; resize:none; font-family:inherit;"></textarea>
    </div>
    <!-- Optional Image -->
    <div class="image-upload-box" style="height:100px; margin-bottom:20px;" onclick="document.getElementById('reportImg').click()">
     <div id="reportImgPlaceholder" class="upload-placeholder">
      <span style="font-size:1.2rem">ğŸ“·</span>
      <br>Attach Proof (Optional)
     </div>
     <img id="reportImgPreview" class="image-preview">
     <input type="file" id="reportImg" hidden accept="image/*" onchange="previewReportImg(this)">
    </div>
    <div class="btn-grid">
     <button class="btn btn-secondary" onclick="closeModalById('reportModal')">Cancel</button>
     <button class="btn btn-primary" onclick="submitReport()">Submit Report</button>
    </div>
   </div>
  </div>
  <!-- MODAL: FORGOT CODE -->
  <div id="forgotModal" class="modal">
   <div class="modal-card">
    <div class="close-modal-x" onclick="closeModalById('forgotModal')">Ã—</div>
    <h3>Recover Code</h3>
    <p style="font-size:0.85rem; color:#71717A; margin-bottom:20px;"> Enter the email you used during registration. We'll send your Access Code there. </p>
    <div class="input-wrapper" style="background:#f9fafb; border:1px solid #e4e4e7; margin-bottom:20px;">
     <input type="email" id="recoveryEmail" placeholder="name@email.com" style="color:black;">
    </div>
    <button class="btn btn-primary" id="btnRecover" style="width:100%" onclick="submitRecovery()">Send Code</button>
   </div>
  </div>
  <script type="module" src="script.js"></script>
 </body>
</html>
