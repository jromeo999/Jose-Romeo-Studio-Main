<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="icons/icon128.png">
    <title>Lecker Admin | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="dashboard-style.css">
</head>
<body>
    <!-- CUSTOM CONFIRM MODAL -->
    <div id="toastBox" class="toast-container"></div>
    <div class="app-layout">
        
        <!-- SIDEBAR -->
        <aside class="dash-sidebar">
            <div class="logo-area">
                <img src="images/lecker-logo.png" alt="Lecker">
                <span>ADMIN</span>
            </div>
            <nav class="dash-nav">
                <button class="nav-btn active" data-view="orders"><i class="fas fa-th-list"></i> Live Orders</button>
                <button class="nav-btn" data-view="sales"><i class="fas fa-table"></i> Sales Tracker</button>
                    <button class="nav-btn" data-view="feedbacks"><i class="fas fa-comment-dots"></i> Feedbacks</button>
                    <button class="nav-btn" data-view="sos"><i class="fas fa-user-shield"></i> SOS Accounts</button>
                <button class="nav-btn locked" title="Coming Soon"><i class="fas fa-users-cog"></i> Attendance <span class="badge-soon">SOON</span></button>
                 <button id="logoutBtn" class="nav-btn mobile-only-logout" onclick="signOut(auth)">
        <i class="fas fa-power-off" style="color: #d32f2f;"></i>
    </button>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Menu</a>
                <button id="logoutBtn"><i class="fas fa-power-off"></i> Logout</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="dash-main">
            
            <!-- VIEW A: LIVE ORDERS -->
            <div id="viewOrders" class="view-section active">
                <header class="top-bar">
                    <h2><span class="dot live"></span> Kitchen Monitor</h2>
                    <!-- UPDATED STATS -->
                    <div class="stats-text">
                        Completed: <span id="statCompleted">0</span> <span class="divider">|</span> Pending: <span id="statPending">0</span>
                    </div>
                </header>
                
                <!-- FULL WIDTH GRID (No more split) -->
                <div id="pendingGrid" class="orders-grid full-width">
                    <!-- Cards injected here -->
                </div>
            </div>

            <!-- VIEW B: SALES TRACKER (Table Mode) -->
            <div id="viewSales" class="view-section">
    <header class="top-bar">
        <h2>Performance & Collection</h2>
        <div class="filters">
    
    <!-- 1. MONTH DROPDOWN -->
    <div class="custom-dd" id="ddMonth">
        <!-- The value used by JS logic -->
        <input type="hidden" id="filterMonth"> 
        
        <!-- The Visible Button -->
        <div class="dd-trigger">
            <span class="dd-label">Select Month</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        
        <!-- The Dropdown Menu -->
        <div class="dd-menu">
            <!-- Options injected by JS -->
        </div>
    </div>

    <!-- 2. YEAR DROPDOWN -->
    <div class="custom-dd" id="ddYear">
        <input type="hidden" id="filterYear">
        <div class="dd-trigger">
            <span class="dd-label">Year</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="dd-menu">
            <!-- Options injected by JS -->
        </div>
    </div>

</div>
    </header>

    <!-- 3-COLUMN GRID WRAPPER -->
    <div class="sales-tri-grid">
        
        <!-- COL 1: DAILY SALES LOG (Existing) -->
        <div class="tri-col">
            <h4 class="col-header">Daily Sales Log</h4>
            <div class="table-container full-height">
                <table class="sales-report-table">
    <thead>
    <tr>
        <th>Date</th>
        <th class="text-center">Count</th>
        <th class="text-right">Cash</th>
        <th class="text-right">Credit</th>
        <th class="text-right">Total</th>
    </tr>
</thead>
    <tbody id="salesTableBody"></tbody>
</table>
            </div>
        </div>

        <!-- COL 2: PAYDAY COLLECTION (New) -->
        <div class="tri-col">
            <div class="payday-header-box">
                <h4 id="paydayTitle">Payday Collection</h4>
                <small id="paydayCycle">Cycle: ...</small>
            </div>
            <div class="table-container full-height">
                <table class="sales-report-table">
                    <thead>
                        <tr>
                            <th>Name / Acct</th>
                            <th class="text-center">Total</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="paydayTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- COL 3: STATS STACK -->
        <div class="tri-col stats-col">
            <!-- Verified Sales -->
            <div class="stat-card compact">
                <h4>Total Revenue</h4>
                <span id="monthTotalSales">₱0</span>
            </div>
            
            <!-- Payday Pending -->
            <div class="stat-card compact pending-stat">
                <h4>To Collect</h4>
                <span id="paydayPendingTotal">₱0</span>
            </div>

            <!-- Misc Stats -->
            <div class="stat-card compact">
                <h4>Total Orders</h4>
                <span id="monthTotalCount">0</span>
            </div>
            <div class="stat-card compact" style="border-left: 3px solid #9c27b0; background: rgba(156, 39, 176, 0.05);">
        <h4>All-Time Record</h4>
        <span id="busiestAllTime" style="font-size: 0.95rem;">-</span>
        <small id="valAllTime" style="color: #9c27b0; font-weight:bold; font-size:0.75rem;">₱0</small>
    </div>

    <!-- 4. NEW: Busiest of the Year -->
    <div class="stat-card compact" style="border-left: 3px solid #2196f3; background: rgba(33, 150, 243, 0.05);">
        <h4>Peak of <span id="lblYear" style=" margin-left: 5px !important;"> This Year</span></h4>
        <span id="busiestYear" style="font-size: 0.95rem;">-</span>
        <small id="valYear" style="color: #2196f3; font-weight:bold; font-size:0.75rem;">₱0</small>
    </div>

    <!-- 5. Busiest of the Month (Existing - Updated ID/Label) -->
    <div class="stat-card compact">
        <h4>Peak of <span id="lblMonth" style=" margin-left: 5px !important;">Month</span></h4>
        <span id="busiestDay" style="font-size: 0.95rem;">-</span>
        <small id="valMonth" style="color: var(--gold); font-weight:bold; font-size:0.75rem;">₱0</small>
    </div>
        </div>

    </div>
</div>
            <div id="viewFeedbacks" class="view-section">
    <header class="top-bar">
        <h2>Customer Reviews</h2>
        <div class="stats-text">
            Avg Rating: <span id="avgRating">0.0</span> <span style="color:var(--gold)">★</span>
        </div>
    </header>

    <!-- Review Cards Grid -->
    <div id="adminReviewsGrid" class="orders-grid full-width">
        <!-- Reviews will be injected here by dashboard.js -->
    </div>
</div>
<div id="viewSOS" class="view-section">
    <header class="top-bar">
        <h2>SOS Employee Database</h2>
        <div class="stats-text">
            Total Users: <span id="sosTotalUsers">0</span>
        </div>
    </header>

    <div class="sos-layout">
        <!-- LEFT PANEL: LIST -->
        <div class="sos-list-col">
            <div class="search-wrap">
                <input type="text" id="sosSearch" placeholder="Search name or company..." class="dark-input">
            </div>
            <div id="sosUserList" class="sos-scroll-list">
                <!-- Injected via JS -->
            </div>
        </div>

        <!-- RIGHT PANEL: HISTORY -->
        <div class="sos-detail-col">
            <div id="sosDetailPlaceholder" class="empty-placeholder">
                <i class="fas fa-id-card"></i>
                <h3>Select an Employee</h3>
                <p>View transaction history and debt status.</p>
            </div>
            
            <div id="sosDetailContent" class="hidden">
                <!-- User Header -->
                <div class="detail-header">
    <div class="dh-left">
        <h2 id="detName">Name</h2>
        <span id="detMeta">Account • Floor</span>
    </div>
    
    <!-- WRAP RIGHT SIDE TO HOLD DEBT + CLOSE BTN -->
    <div class="dh-right" style="display:flex; align-items:center; gap:15px;">
        <div class="debt-tag">
            <small>UNPAID DEBT</small>
            <span id="detDebt">₱0</span>
        </div>
        
        <!-- NEW CLEAR BUTTON -->
        <button onclick="clearSOSSelection()" class="btn-close-circle" title="Close Selection">
    <i class="fas fa-times"></i>
</button>
    </div>
</div>

                <!-- History List -->
                <div class="history-scroll-container">
                    <table class="log-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Status</th>
                                <th class="text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody id="sosHistoryBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
            <!-- VIEW C: ATTENDANCE -->
            <div id="viewAttendance" class="view-section">
                <div class="empty-placeholder">
                    <i class="fas fa-user-clock"></i>
                    <h2>Staff Attendance Tracking</h2>
                    <p>Coming Soon</p>
                </div>
            </div>

        </main>
        

        <!-- RIGHT DRAWER (Daily Log) -->
        <div id="dailyLogDrawer" class="right-drawer">
    <div class="drawer-header">
        <h3 id="drawerTitle">Today's Log</h3> <!-- Added ID to change title dynamically -->
        <button id="closeDrawer" class="close-drawer-btn"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="drawer-content">
        <table class="log-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Summary</th>
                    <th>Method</th> <!-- NEW COLUMN -->
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="dailyLogBody">
                <!-- Rows injected here -->
            </tbody>
        </table>
    </div>
        </div>

        <div id="openDrawerBtn" class="drawer-trigger"><i class="fas fa-history"></i></div>
    </div>
    <!-- CUSTOM CONFIRM MODAL -->
<div id="customConfirmModal" class="modal-overlay hidden">
    <div class="login-box" style="width: 360px; text-align: center;">
        
        <!-- Animated Icon -->
        <div class="confirm-icon-box">
            <i class="fas fa-question-circle"></i>
        </div>
        
        <!-- Header -->
        <h2 style="color: white; margin-bottom: 10px; font-size: 1.5rem;">Are you sure?</h2>
        
        <!-- Dynamic Message -->
        <p id="confirmMsg">Please confirm this action.</p>
        
        <!-- Buttons -->
        <div class="confirm-actions">
            <button id="btnConfirmNo" class="btn-modal cancel">
                Cancel
            </button>
            <button id="btnConfirmYes" class="btn-modal confirm">
                Yes, Proceed
            </button>
        </div>

    </div>
</div>
<div id="proofLightbox" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
    <div class="login-box" style="width: auto; max-width: 90%; background: transparent; box-shadow: none; border: none;">
        <img id="proofImgDisplay" src="" style="max-height: 80vh; max-width: 100%; border-radius: 8px; border: 2px solid var(--gold);">
        <p style="text-align: center; color: white; margin-top: 10px;">Click anywhere to close</p>
    </div>
</div>
    <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    <script type="module" src="dashboard.js"></script>
</body>
</html>