<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOS MARKETPLACE</title>
    <!-- Premium Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="header-content">
            <div class="top-bar">
                <h1>SOS Marketplace</h1>
                <div class="datetime" id="clock">--:--</div>
            </div>

            <!-- LOGIN BAR -->
            <div class="auth-bar" id="loginSection">
                <input type="text" id="codeJson" placeholder="Enter Access Code" autocomplete="off">
                <button onclick="handleLogin()" class="icon-btn">➜</button>
                <button class="secondary text-btn" onclick="openNewVendor()">Join</button>
            </div>

            <!-- VENDOR CONTROLS -->
            <div class="auth-bar hidden" id="vendorControls">
                <div class="vendor-badge">
                    <span class="dot"></span>
                    <span id="vendorGreeting">Vendor</span>
                </div>
                <div class="action-row">
                    <button class="small-btn ghost" onclick="openSalesHistory()">History</button>
                    <button class="small-btn ghost danger-text" onclick="soldOut()">Sold Out</button>
                    <button class="small-btn ghost" onclick="logout()">Log Out</button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTAINER (Centers content and prevents stretching) -->
    <main class="app-container">
        
        <!-- VIEW: BUYER -->
        <div id="buyerView" class="fade-in">
            <div class="tabs">
                <div class="tab-btn active" onclick="switchTab('today')" id="tab-today">Today</div>
                <div class="tab-btn" onclick="switchTab('preorder')" id="tab-preorder">Pre-Order</div>
            </div>

            <div id="view-today" class="tab-content active-content">
                <div class="grid-stack" id="buyerTodayGrid"></div>
            </div>

            <div id="view-preorder" class="tab-content hidden">
                <div class="grid-stack" id="buyerPreOrderGrid"></div>
            </div>
        </div>

        <!-- VIEW: VENDOR DASHBOARD -->
        <div id="vendorView" class="hidden fade-in">
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="section-header">
                        <h3>Inventory</h3>
                        <button class="add-btn" onclick="openAddModal()">+ Add Item</button>
                    </div>
                    <div class="vendor-card flat">
                        <div id="adminProductList"></div>
                    </div>
                    <button class="secondary save-config-btn" onclick="saveConfig()">Save Configuration</button>
                </div>

                <div class="panel">
                    <div class="section-header">
                        <h3>Live Orders</h3>
                        <button class="finish-btn" onclick="finishDay()">End Shift</button>
                    </div>
                    <div class="vendor-card flat">
                        <div class="card-content scrollable" id="orderList">
                            <div class="empty-state">No orders yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: SALES HISTORY -->
        <div id="salesView" class="hidden fade-in">
            <div class="section-header">
                <h3>Sales Performance</h3>
                <button class="secondary small-btn" onclick="closeSalesHistory()">Back</button>
            </div>
            <div class="vendor-card flat">
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th class="text-center">Count</th>
                            <th class="text-center">Items</th>
                            <th class="text-right">Revenue</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody"></tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- MODALS -->
    <div id="productModal" class="modal hidden">
        <div class="modal-card">
            <h3>Manage Item</h3>
            <input type="hidden" id="mId">
            <div class="input-group">
                <input type="text" id="mName" placeholder="Product Name">
            </div>
            <div class="input-group">
                <input type="number" id="mPrice" placeholder="Price (₱)">
            </div>
            <div class="file-upload-wrapper">
                <label>Product Image</label>
                <input type="file" id="mFile" accept="image/*">
            </div>
            <div class="modal-actions">
                <button class="secondary" onclick="closeModal()">Cancel</button>
                <button class="primary" onclick="commitProduct()">Save Item</button>
            </div>
        </div>
    </div>

    <div id="newVendorModal" class="modal hidden" onclick="handleModalClick(event, 'newVendorModal')">
        <div class="modal-card">
            <span class="close-icon" onclick="closeNewVendor()">&times;</span>
            <h3>New Shop</h3>
            <input type="text" id="vName" placeholder="Shop Name">
            <input type="text" id="vAccount" placeholder="Account">
            <div class="modal-actions">
                <button class="primary full-width" onclick="registerVendor()">Create Shop</button>
            </div>
        </div>
    </div>

    <div id="salesDetailModal" class="modal hidden" onclick="handleModalClick(event, 'salesDetailModal')">
        <div class="modal-card scrollable-modal">
            <div class="modal-header">
                <h3 id="detailDate">Details</h3>
                <span class="close-icon" onclick="document.getElementById('salesDetailModal').classList.add('hidden')">&times;</span>
            </div>
            <div id="detailList"></div>
        </div>
    </div>

    <div id="lightbox" class="lightbox hidden" onclick="closeLightbox()">
        <img id="lightbox-img" class="lightbox-content">
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
