<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="icons/icon.png">
    <title>Joanna's Admin | Dashboard</title>  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="dashboard-style.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      emailjs.init("_vpMAL03l1qt9rrgS"); // Your Public Key
   })();
</script>
</head>
<body>
    <!-- CUSTOM CONFIRM MODAL -->
    <div id="toastBox" class="toast-container"></div>
    <div class="app-layout">
        
        <!-- SIDEBAR -->
        <aside class="dash-sidebar">
            <div class="logo-area">
    <img src="icons/brand.png" alt="Joanna's">
    <div style="display:flex; flex-direction:column; line-height:1.2;">
        <span style="color:var(--gold);">JOANNA'S</span>
        <span style="font-size:0.6rem; color:#ccc;">ADMIN DASHBOARD</span>
    </div>
</div>
            <nav class="dash-nav">
                <button class="nav-btn active" data-view="orders"><i class="fas fa-th-list"></i> Live Orders</button>
                <button class="nav-btn" data-view="sales"><i class="fas fa-table"></i> Sales Tracker</button>
                    <button class="nav-btn" data-view="feedbacks"><i class="fas fa-comment-dots"></i> Feedbacks</button>
                <button class="nav-btn locked" title="Coming Soon"><i class="fas fa-users-cog"></i> Attendance <span class="badge-soon">SOON</span></button>
                <button class="nav-btn mobile-only-logout btn-logout-action"> <!-- Removed ID, Added Class -->
    <i class="fas fa-power-off" style="color: #d32f2f;"></i>
</button>
</nav>
<!-- 2. Desktop Footer Logout (Bottom of Sidebar) -->
<div class="sidebar-footer">
    <a class='back-link' href='/'><i class="fas fa-arrow-left"></i> Back to Menu</a>
    <!-- Removed ID, Added Class, Removed onclick -->
    <button class="btn-logout-action">
        <i id="logoutBtn" class="fas fa-power-off" style="color: #d32f2f;"></i>
    </button>
    </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="dash-main">
            
            <!-- VIEW A: LIVE ORDERS -->
            <div id="viewOrders" class="view-section active">
                <header class="top-bar">
                    <h2><span class="dot live"></span> Kitchen Monitor</h2>
                    <!-- UPDATED STATS -->
                    <div class="stats-text">
                        Completed: <span id="statCompleted">0</span> <span class="divider">|</span> Pending: <span id="statPending">0</span>
                    </div>
                </header>
                
                <!-- FULL WIDTH GRID (No more split) -->
                <div id="pendingGrid" class="orders-grid full-width">
                    <!-- Cards injected here -->
                </div>
            </div>

            <!-- VIEW B: SALES TRACKER (Table Mode) -->
            <div id="viewSales" class="view-section">
    <header class="top-bar">
        <h2>Performance & Collection</h2>
        <div class="filters">
    
    <!-- 1. MONTH DROPDOWN -->
    <div class="custom-dd" id="ddMonth">
        <!-- The value used by JS logic -->
        <input type="hidden" id="filterMonth"> 
        
        <!-- The Visible Button -->
        <div class="dd-trigger">
            <span class="dd-label">Select Month</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        
        <!-- The Dropdown Menu -->
        <div class="dd-menu">
            <!-- Options injected by JS -->
        </div>
    </div>

    <!-- 2. YEAR DROPDOWN -->
    <div class="custom-dd" id="ddYear">
        <input type="hidden" id="filterYear">
        <div class="dd-trigger">
            <span class="dd-label">Year</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="dd-menu">
            <!-- Options injected by JS -->
        </div>
    </div>

</div>
    </header>

    <!-- 3-COLUMN GRID WRAPPER -->
    <!-- 2-COLUMN GRID (Removed Payday Column) -->
<div class="sales-tri-grid" style="grid-template-columns: 1fr 300px;"> 
    
    <!-- COL 1: DAILY SALES LOG -->
    <div class="tri-col">
        <h4 class="col-header">Daily Sales Log</h4>
        <div class="table-container full-height">
            <table class="sales-report-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th class="text-center">Count</th>
                        <th class="text-right">Cash</th>
                        <th class="text-right">Online</th> <!-- Renamed Credit to Online -->
                        <th class="text-right">Total</th>
                    </tr>
                </thead>
                <tbody id="salesTableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- COL 2: STATS STACK -->
    <div class="tri-col stats-col">
        <!-- Revenue -->
        <div class="stat-card compact">
            <h4>Total Revenue</h4>
            <span id="monthTotalSales">₱0</span>
        </div>
        
        <!-- Total Orders -->
        <div class="stat-card compact">
            <h4>Total Orders</h4>
            <span id="monthTotalCount">0</span>
        </div>

        <!-- Records -->
        <div class="stat-card compact" style="border-left: 3px solid #9c27b0; background: rgba(109, 78, 109, 0.05);">
            <h4>All-Time Record</h4>
            <span id="busiestAllTime" style="font-size: 0.95rem;">-</span>
            <small id="valAllTime" style="color: #9c27b0; font-weight:bold; font-size:0.75rem;">₱0</small>
        </div>

        <div class="stat-card compact" style="border-left: 3px solid #2196f3; background: rgba(18, 118, 201, 0.05);">
            <h4>Peak of <span id="lblYear" style=" margin-left: 5px !important;"> This Year</span></h4>
            <span id="busiestYear" style="font-size: 0.95rem;">-</span>
            <small id="valYear" style="color: #2196f3; font-weight:bold; font-size:0.75rem;">₱0</small>
        </div>

        <div class="stat-card compact">
            <h4>Peak of <span id="lblMonth" style=" margin-left: 5px !important;">Month</span></h4>
            <span id="busiestDay" style="font-size: 0.95rem;">-</span>
            <small id="valMonth" style="color: var(--gold); font-weight:bold; font-size:0.75rem;">₱0</small>
        </div>
    </div>
</div>
</div>
            <div id="viewFeedbacks" class="view-section">
    <header class="top-bar">
        <h2>Customer Reviews</h2>
        <div class="stats-text">
            Avg Rating: <span id="avgRating">0.0</span> <span style="color:var(--gold)">★</span>
        </div>
    </header>

    <!-- Review Cards Grid -->
    <div id="adminReviewsGrid" class="orders-grid full-width">
        <!-- Reviews will be injected here by dashboard.js -->
    </div>
</div>
            <!-- VIEW C: ATTENDANCE -->
            <div id="viewAttendance" class="view-section">
                <div class="empty-placeholder">
                    <i class="fas fa-user-clock"></i>
                    <h2>Staff Attendance Tracking</h2>
                    <p>Coming Soon</p>
                </div>
            </div>

        </main>
        

        <!-- RIGHT DRAWER (Daily Log) -->
        <!-- RIGHT DRAWER (Daily Log) -->
<div id="dailyLogDrawer" class="right-drawer">
    <div class="drawer-header">
        <h3 id="drawerTitle">Today's Log</h3>
        <button id="closeDrawer" class="close-drawer-btn"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="drawer-content">
        <table class="log-table">
            <thead>
                <tr>
                    <th style="width:30%">Time / Name</th>
                    <th style="width:30%">Summary</th>
                    <th style="width:20%">Method</th>
                    <th style="width:20%" class="text-right">Total</th>
                </tr>
            </thead>
            <tbody id="dailyLogBody">
                <!-- Rows injected here -->
            </tbody>
        </table>
    </div>
</div>

        <div id="openDrawerBtn" class="drawer-trigger"><i class="fas fa-history"></i></div>
    </div>
    <!-- CUSTOM CONFIRM MODAL -->
<div id="customConfirmModal" class="modal-overlay hidden">
    <div class="login-box" style="width: 360px; text-align: center;">
        
        <!-- Animated Icon -->
        <div class="confirm-icon-box">
            <i class="fas fa-question-circle"></i>
        </div>
        
        <!-- Header -->
        <h2 style="color: white; margin-bottom: 10px; font-size: 1.5rem;">Are you sure?</h2>
        
        <!-- Dynamic Message -->
        <p id="confirmMsg">Please confirm this action.</p>
        
        <!-- Buttons -->
        <div class="confirm-actions">
            <button id="btnConfirmNo" class="btn-modal cancel">
                Cancel
            </button>
            <button id="btnConfirmYes" class="btn-modal confirm">
                Yes, Proceed
            </button>
        </div>

    </div>
</div>
<div id="proofLightbox" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
    <div class="login-box" style="width: auto; max-width: 90%; background: transparent; box-shadow: none; border: none;">
        <img id="proofImgDisplay" src="" style="max-height: 80vh; max-width: 100%; border-radius: 8px; border: 2px solid var(--gold);">
        <p style="text-align: center; color: white; margin-top: 10px;">Click anywhere to close</p>
    </div>
</div>
<!-- CASHIER CALCULATOR MODAL -->
<div id="cashModal" class="modal-overlay hidden">
    <div class="login-box" style="width: 400px; border-color: var(--gold);">
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2 style="margin:0; font-size:1.2rem; color:var(--gold);">Cash Payment</h2>
            <button onclick="closeCashModal()" style="background:none; border:none; color:#666; font-size:1.5rem; cursor:pointer;">&times;</button>
        </div>

        <!-- Order Info -->
        <div style="text-align:center; margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed #333;">
            <p style="color:#aaa; font-size:0.9rem;">Total Amount Due</p>
            <h1 id="cashModalTotal" style="color:white; font-size:2.5rem; margin:0;">₱0</h1>
        </div>

        <!-- 1. The Screen -->
        <div class="calc-display" style="background:black; border:1px solid #444; padding:15px; border-radius:8px; margin-bottom:15px; display:flex; justify-content:space-between;">
            <div>
                <span style="font-size:0.7rem; color:#888; text-transform:uppercase; display:block;">Cash Received</span>
                <span id="dispCashReceived" style="font-size:1.2rem; font-weight:bold; color:var(--gold);">₱0</span>
            </div>
            <div style="text-align:right;">
                <span style="font-size:0.7rem; color:#888; text-transform:uppercase; display:block;">Change</span>
                <span id="dispChange" style="font-size:1.4rem; font-weight:bold; color:#ff6b6b;">₱0</span>
            </div>
        </div>

        <!-- 2. The Keypad -->
        <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; margin-bottom:20px;">
            <button class="btn-denom" onclick="dashAddCash(50)">50</button>
            <button class="btn-denom" onclick="dashAddCash(100)">100</button>
            <button class="btn-denom" onclick="dashAddCash(200)">200</button>
            <button class="btn-denom" onclick="dashAddCash(500)">500</button>
            <button class="btn-denom" onclick="dashAddCash(1000)">1k</button>
            
            <button class="btn-denom" style="background:#d32f2f; color:white;" onclick="dashResetCash()">Clear</button>
            <button class="btn-denom" style="background:var(--gold); color:black; grid-column: span 2; font-weight:bold;" onclick="dashExactCash()">Exact Amount</button>
        </div>

        <!-- Hidden Logic -->
        <input type="hidden" id="activeOrderId">
        <input type="hidden" id="activeOrderTotal">

        <!-- Action -->
        <button id="btnConfirmPayment" disabled onclick="submitCashPayment()" 
                style="width:100%; padding:15px; background:#333; color:#666; font-weight:bold; border:none; border-radius:6px; cursor:not-allowed; transition:0.2s;">
            CONFIRM PAYMENT
        </button>
    </div>
</div>
    <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    <script type="module" src="dashboard.js"></script>
</body>
</html>